{% extends 'health/base_health.html' %}
{% load i18n %}

{% block extra_css %}
<style>
.radio-matrix {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 16px;
}
.radio-matrix th, .radio-matrix td {
    text-align: center;
    padding: 8px 4px;
    border-bottom: 1px solid var(--gray-200);
}
.radio-matrix th {
    font-weight: 600;
    font-size: 0.75rem;
    color: var(--gray-500);
}
.radio-matrix .question-cell {
    text-align: left;
    min-width: 120px;
    font-weight: 500;
    font-size: 0.875rem;
}
.radio-matrix .hint {
    display: block;
    font-size: 0.75rem;
    color: var(--gray-500);
    font-weight: 400;
}
.radio-matrix input[type="radio"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: var(--primary);
}
.radio-matrix tr:hover {
    background-color: var(--gray-50);
}
@media (max-width: 480px) {
    .radio-matrix {
        font-size: 0.8rem;
    }
    .radio-matrix th, .radio-matrix td {
        padding: 6px 2px;
    }
    .radio-matrix input[type="radio"] {
        width: 18px;
        height: 18px;
    }
    .radio-matrix .question-cell {
        min-width: 90px;
    }
    .radio-matrix .hint {
        font-size: 0.65rem;
    }
}
</style>
{% endblock %}

{% block main_content %}
<form id="dailyForm">
    {% csrf_token %}

    <div class="card summary-card">
        <h2>{% trans "Was today a good day?" %}</h2>
        <div class="day-rating">
            <label class="rating-option">
                <input type="radio" name="good_day" value="yes" {% if entry.good_day == 'yes' %}checked{% endif %}>
                <span class="rating-btn good">{% trans "Yes" %}</span>
            </label>
            <label class="rating-option">
                <input type="radio" name="good_day" value="mixed" {% if entry.good_day == 'mixed' %}checked{% endif %}>
                <span class="rating-btn mixed">{% trans "Mixed" %}</span>
            </label>
            <label class="rating-option">
                <input type="radio" name="good_day" value="no" {% if entry.good_day == 'no' %}checked{% endif %}>
                <span class="rating-btn bad">{% trans "No" %}</span>
            </label>
        </div>
    </div>

    <div class="card">
        <h2>{% trans "Mood & Engagement" %}</h2>
        <p class="card-subtitle">{% trans "Happiness indicators" %}</p>

        <div class="table-responsive">
            <table class="radio-matrix">
                <thead>
                    <tr>
                        <th class="question-cell"></th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="question-cell">
                            {% trans "Tail / Body Language" %}
                            <span class="hint">{% trans "Relaxed, wagging vs stiff" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="tail_body_language" value="{{ forloop.counter0 }}" {% if entry.tail_body_language == forloop.counter0 or entry.tail_body_language == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Interest in People" %}
                            <span class="hint">{% trans "Seeks affection vs disengaged" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="interest_people" value="{{ forloop.counter0 }}" {% if entry.interest_people == forloop.counter0 or entry.interest_people == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Interest in Environment" %}
                            <span class="hint">{% trans "Sniffing, alert vs dull" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="interest_environment" value="{{ forloop.counter0 }}" {% if entry.interest_environment == forloop.counter0 or entry.interest_environment == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Enjoyment of Favorites" %}
                            <span class="hint">{% trans "Toys, walks, treats" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="enjoyment_favorites" value="{{ forloop.counter0 }}" {% if entry.enjoyment_favorites == forloop.counter0 or entry.enjoyment_favorites == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Overall Spark" %}
                            <span class="hint">{% trans "Joy vs flatness" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="overall_spark" value="{{ forloop.counter0 }}" {% if entry.overall_spark == forloop.counter0 or entry.overall_spark == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>{% trans "Appetite & Eating" %}</h2>

        <div class="table-responsive">
            <table class="radio-matrix">
                <thead>
                    <tr>
                        <th class="question-cell"></th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="question-cell">
                            {% trans "Appetite" %}
                            <span class="hint">{% trans "Eats willingly vs refusal" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="appetite" value="{{ forloop.counter0 }}" {% if entry.appetite == forloop.counter0 or entry.appetite == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Food Enjoyment" %}
                            <span class="hint">{% trans "Excited vs reluctant" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="food_enjoyment" value="{{ forloop.counter0 }}" {% if entry.food_enjoyment == forloop.counter0 or entry.food_enjoyment == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Nausea Signs" %}
                            <span class="hint">{% trans "5 = none, 0 = vomiting" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="nausea_signs" value="{{ forloop.counter0 }}" {% if entry.nausea_signs == forloop.counter0 or entry.nausea_signs == None and forloop.counter0 == 5 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Weight / Body Condition" %}
                            <span class="hint">{% trans "Stable vs noticeable loss" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="weight_condition" value="{{ forloop.counter0 }}" {% if entry.weight_condition == forloop.counter0 or entry.weight_condition == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="metric">
            <label>{% trans "Meals Eaten Today" %}</label>
            <div class="meal-checkboxes">
                <label class="checkbox-option">
                    <input type="checkbox" name="breakfast" {% if entry.breakfast %}checked{% endif %}>
                    <span>{% trans "Breakfast" %}</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="lunch" {% if entry.lunch %}checked{% endif %}>
                    <span>{% trans "Lunch" %}</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="dinner" {% if entry.dinner %}checked{% endif %}>
                    <span>{% trans "Dinner" %}</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" name="treats" {% if entry.treats %}checked{% endif %}>
                    <span>{% trans "Treats" %}</span>
                </label>
            </div>
        </div>
    </div>

    <div class="card">
        <h2>{% trans "Energy & Mobility" %}</h2>

        <div class="table-responsive">
            <table class="radio-matrix">
                <thead>
                    <tr>
                        <th class="question-cell"></th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="question-cell">
                            {% trans "Energy Level" %}
                            <span class="hint">{% trans "Normal vs lethargic" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="energy_level" value="{{ forloop.counter0 }}" {% if entry.energy_level == forloop.counter0 or entry.energy_level == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Willingness to Move" %}
                            <span class="hint">{% trans "Gets up easily vs hesitation" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="willingness_move" value="{{ forloop.counter0 }}" {% if entry.willingness_move == forloop.counter0 or entry.willingness_move == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Walking Comfort" %}
                            <span class="hint">{% trans "Smooth gait vs limping" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="walking_comfort" value="{{ forloop.counter0 }}" {% if entry.walking_comfort == forloop.counter0 or entry.walking_comfort == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Resting Comfort" %}
                            <span class="hint">{% trans "Settles easily vs restless" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="resting_comfort" value="{{ forloop.counter0 }}" {% if entry.resting_comfort == forloop.counter0 or entry.resting_comfort == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>{% trans "Pain & Physical Comfort" %}</h2>

        <div class="table-responsive">
            <table class="radio-matrix">
                <thead>
                    <tr>
                        <th class="question-cell"></th>
                        <th>0</th>
                        <th>1</th>
                        <th>2</th>
                        <th>3</th>
                        <th>4</th>
                        <th>5</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="question-cell">
                            {% trans "Breathing Comfort" %}
                            <span class="hint">{% trans "Normal vs labored" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="breathing_comfort" value="{{ forloop.counter0 }}" {% if entry.breathing_comfort == forloop.counter0 or entry.breathing_comfort == None and forloop.counter0 == 5 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Pain Signs" %}
                            <span class="hint">{% trans "5 = none, 0 = panting, whining" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="pain_signs" value="{{ forloop.counter0 }}" {% if entry.pain_signs == forloop.counter0 or entry.pain_signs == None and forloop.counter0 == 5 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Sleep Quality" %}
                            <span class="hint">{% trans "Restful vs disrupted" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="sleep_quality" value="{{ forloop.counter0 }}" {% if entry.sleep_quality == forloop.counter0 or entry.sleep_quality == None and forloop.counter0 == 3 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td class="question-cell">
                            {% trans "Response to Touch" %}
                            <span class="hint">{% trans "Enjoys vs flinches" %}</span>
                        </td>
                        {% for i in "012345" %}
                        <td><input type="radio" name="response_touch" value="{{ forloop.counter0 }}" {% if entry.response_touch == forloop.counter0 or entry.response_touch == None and forloop.counter0 == 5 %}checked{% endif %}></td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card">
        <h2>{% trans "Notes" %}</h2>

        <div class="metric">
            <label>{% trans "What made today good?" %}</label>
            <textarea name="good_notes" rows="2" placeholder="{% trans 'Optional...' %}">{{ entry.good_notes }}</textarea>
        </div>

        <div class="metric">
            <label>{% trans "What seemed hardest?" %}</label>
            <textarea name="hard_notes" rows="2" placeholder="{% trans 'Optional...' %}">{{ entry.hard_notes }}</textarea>
        </div>

        <div class="metric">
            <label>{% trans "Other observations" %}</label>
            <textarea name="other_notes" rows="2" placeholder="{% trans 'Fever, coughing, diarrhea, bad breath changes...' %}">{{ entry.other_notes }}</textarea>
        </div>
    </div>

    <button type="submit" class="save-btn">{% trans "Save Today's Entry" %}</button>
</form>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('dailyForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = new FormData(form);

        const data = {
            good_day: formData.get('good_day') || '',
            tail_body_language: parseInt(formData.get('tail_body_language')),
            interest_people: parseInt(formData.get('interest_people')),
            interest_environment: parseInt(formData.get('interest_environment')),
            enjoyment_favorites: parseInt(formData.get('enjoyment_favorites')),
            overall_spark: parseInt(formData.get('overall_spark')),
            appetite: parseInt(formData.get('appetite')),
            food_enjoyment: parseInt(formData.get('food_enjoyment')),
            nausea_signs: parseInt(formData.get('nausea_signs')),
            weight_condition: parseInt(formData.get('weight_condition')),
            breakfast: formData.get('breakfast') === 'on',
            lunch: formData.get('lunch') === 'on',
            dinner: formData.get('dinner') === 'on',
            treats: formData.get('treats') === 'on',
            energy_level: parseInt(formData.get('energy_level')),
            willingness_move: parseInt(formData.get('willingness_move')),
            walking_comfort: parseInt(formData.get('walking_comfort')),
            resting_comfort: parseInt(formData.get('resting_comfort')),
            breathing_comfort: parseInt(formData.get('breathing_comfort')),
            pain_signs: parseInt(formData.get('pain_signs')),
            sleep_quality: parseInt(formData.get('sleep_quality')),
            response_touch: parseInt(formData.get('response_touch')),
            good_notes: formData.get('good_notes'),
            hard_notes: formData.get('hard_notes'),
            other_notes: formData.get('other_notes'),
        };

        try {
            const response = await fetch('{% url "health:save_entry" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken'),
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                showToast('{% trans "Entry saved!" %}');
            } else {
                showToast('{% trans "Error saving entry" %}');
            }
        } catch (err) {
            showToast('{% trans "Error saving entry" %}');
        }
    });
</script>
{% endblock %}
